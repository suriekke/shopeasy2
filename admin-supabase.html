<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopEasy Admin Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- Login Screen -->
        <div id="loginScreen" class="flex items-center justify-center min-h-screen">
            <div class="max-w-md w-full space-y-8 p-8">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-gray-900">ShopEasy Admin Portal</h2>
                    <p class="mt-2 text-gray-600">Connected to Supabase Database</p>
                </div>
                
                <div class="bg-white py-8 px-6 shadow-xl rounded-lg">
                    <form id="loginForm" class="space-y-6">
                        <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded"></div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="email" value="admin@shopeasy.com" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Password</label>
                            <input type="password" id="password" value="admin123" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                        </div>
                        
                        <div>
                            <button type="submit" id="loginBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500">
                                Sign In
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Dashboard Screen -->
        <div id="dashboardScreen" class="hidden min-h-screen">
            <!-- Sidebar -->
            <div class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg">
                <div class="flex items-center justify-center h-16 bg-pink-600">
                    <h1 class="text-white font-bold text-lg">ShopEasy Admin</h1>
                </div>
                
                <nav class="mt-8">
                    <div class="px-4 space-y-2">
                        <button onclick="showPage('dashboard')" class="nav-btn w-full flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-pink-50 hover:text-pink-600 transition-colors" data-page="dashboard">
                            <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                        </button>
                        <button onclick="showPage('products')" class="nav-btn w-full flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-pink-50 hover:text-pink-600 transition-colors" data-page="products">
                            <i class="fas fa-box mr-3"></i>Products
                        </button>
                        <button onclick="showPage('orders')" class="nav-btn w-full flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-pink-50 hover:text-pink-600 transition-colors" data-page="orders">
                            <i class="fas fa-shopping-cart mr-3"></i>Orders
                        </button>
                        <button onclick="showPage('users')" class="nav-btn w-full flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-pink-50 hover:text-pink-600 transition-colors" data-page="users">
                            <i class="fas fa-users mr-3"></i>Users
                        </button>
                        <button onclick="showPage('analytics')" class="nav-btn w-full flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-pink-50 hover:text-pink-600 transition-colors" data-page="analytics">
                            <i class="fas fa-chart-bar mr-3"></i>Analytics
                        </button>
                    </div>
                </nav>
                
                <div class="absolute bottom-4 left-4 right-4">
                    <button id="logoutBtn" class="w-full flex items-center px-4 py-2 text-red-600 rounded-lg hover:bg-red-50 transition-colors">
                        <i class="fas fa-sign-out-alt mr-3"></i>Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="ml-64">
                <!-- Header -->
                <header class="bg-white shadow-sm border-b px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h2>
                            <p class="text-sm text-gray-600">Welcome back, <span id="adminName">Admin</span>!</p>
                        </div>
                    </div>
                </header>

                <!-- Page Content -->
                <main class="p-6">
                    <!-- Dashboard Page -->
                    <div id="dashboardPage" class="page-content">
                        <div class="max-w-7xl mx-auto">
                            <!-- Stats Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-full bg-green-500 text-white">
                                            <i class="fas fa-money-bill-wave text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600">Total Revenue</p>
                                            <p class="text-2xl font-semibold text-gray-900" id="totalRevenue">â‚¹0</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-full bg-blue-500 text-white">
                                            <i class="fas fa-box text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600">Total Products</p>
                                            <p class="text-2xl font-semibold text-gray-900" id="totalProducts">0</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-full bg-purple-500 text-white">
                                            <i class="fas fa-tags text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600">Categories</p>
                                            <p class="text-2xl font-semibold text-gray-900" id="totalCategories">0</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center">
                                        <div class="p-3 rounded-full bg-yellow-500 text-white">
                                            <i class="fas fa-exclamation-triangle text-xl"></i>
                                        </div>
                                        <div class="ml-4">
                                            <p class="text-sm font-medium text-gray-600">Low Stock Items</p>
                                            <p class="text-2xl font-semibold text-gray-900" id="lowStockItems">0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Products Table -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900">Grocery Products</h3>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="tableNameInput" placeholder="Table name (e.g., groceries)" class="px-3 py-1 border border-gray-300 rounded text-sm" value="groceries">
                                        <button onclick="loadDashboardData()" class="bg-pink-600 text-white px-3 py-1 rounded text-sm hover:bg-pink-700">
                                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                            </tr>
                                        </thead>
                                        <tbody id="groceriesTableBody" class="bg-white divide-y divide-gray-200">
                                            <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Loading products...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products Page -->
                    <div id="productsPage" class="page-content hidden">
                        <div class="max-w-7xl mx-auto">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-900">Product Management</h3>
                                <button onclick="showAddProductModal()" class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors">
                                    <i class="fas fa-plus mr-2"></i>Add Product
                                </button>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <p class="text-gray-500 text-center">Product management with CRUD operations coming soon...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Page -->
                    <div id="ordersPage" class="page-content hidden">
                        <div class="max-w-7xl mx-auto">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">Order Management</h3>
                            <div class="bg-white rounded-lg shadow p-6">
                                <p class="text-gray-500 text-center">Orders management coming soon...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Users Page -->
                    <div id="usersPage" class="page-content hidden">
                        <div class="max-w-7xl mx-auto">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">User Management</h3>
                            <div class="bg-white rounded-lg shadow p-6">
                                <p class="text-gray-500 text-center">User management coming soon...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Page -->
                    <div id="analyticsPage" class="page-content hidden">
                        <div class="max-w-7xl mx-auto">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">Analytics Dashboard</h3>
                            <div class="bg-white rounded-lg shadow p-6">
                                <p class="text-gray-500 text-center">Analytics dashboard coming soon...</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- Add Product Modal -->
        <div id="addProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                    <div class="flex justify-between items-center p-6 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">Add New Product</h3>
                        <button onclick="hideAddProductModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <form id="addProductForm" class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Product Name</label>
                            <input type="text" id="productName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Category</label>
                            <select id="productCategory" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">Select Category</option>
                                <option value="Fruits">Fruits</option>
                                <option value="Vegetables">Vegetables</option>
                                <option value="Dairy">Dairy</option>
                                <option value="Bakery">Bakery</option>
                                <option value="Poultry">Poultry</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Price (â‚¹)</label>
                            <input type="number" id="productPrice" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Stock Quantity</label>
                            <input type="number" id="productStock" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Unit</label>
                            <input type="text" id="productUnit" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="kg, dozen, liter, etc.">
                        </div>
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="hideAddProductModal()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
                                Cancel
                            </button>
                            <button type="submit" class="px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700">
                                Add Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const supabaseUrl = 'https://fxrvemzqhoyfbsksrxzo.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4cnZlbXpxaG95ZmJza3NyeHpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0NTU3NDksImV4cCI6MjA3MjAzMTc0OX0.dVjXTsmLvmSWVzza7EQy06oKTfrGTzR9STFpjLN8ghQ';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboardScreen = document.getElementById('dashboardScreen');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminName = document.getElementById('adminName');
        const pageTitle = document.getElementById('pageTitle');

        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = emailInput.value;
            const password = passwordInput.value;
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';
            hideError();
            
            // Simple demo authentication
            if (email === 'admin@shopeasy.com' && password === 'admin123') {
                showDashboard();
            } else {
                showError('Invalid credentials.');
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            showLogin();
        });

        // Show login screen
        function showLogin() {
            loginScreen.classList.remove('hidden');
            dashboardScreen.classList.add('hidden');
        }

        // Show dashboard
        function showDashboard() {
            loginScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            
            adminName.textContent = emailInput.value || 'Admin';
            loginBtn.disabled = false;
            loginBtn.textContent = 'Sign In';
            
            // Load dashboard data
            loadDashboardData();
        }

        // Navigation functions
        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            
            // Show selected page
            document.getElementById(page + 'Page').classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-pink-50', 'text-pink-600');
                btn.classList.add('text-gray-700');
            });
            
            document.querySelector(`[data-page="${page}"]`).classList.add('bg-pink-50', 'text-pink-600');
            document.querySelector(`[data-page="${page}"]`).classList.remove('text-gray-700');
            
            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                products: 'Product Management',
                orders: 'Order Management',
                users: 'User Management',
                analytics: 'Analytics Dashboard'
            };
            pageTitle.textContent = titles[page];
        }

        // Load dashboard data from Supabase
        async function loadDashboardData() {
            try {
                console.log('Loading data from Supabase...');
                console.log('Supabase URL:', supabaseUrl);
                console.log('Supabase Key:', supabaseKey.substring(0, 20) + '...');
                
                // First, let's try to get table information
                console.log('Testing different table names...');
                
                // Get table name from input or try common names
                const manualTableName = document.getElementById('tableNameInput').value.trim();
                const possibleTables = manualTableName ? [manualTableName] : ['groceries', 'grocery', 'products', 'items', 'food_items'];
                let foundTable = null;
                let foundData = null;
                
                for (const tableName of possibleTables) {
                    try {
                        console.log('Trying table:', tableName);
                        const { data, error } = await supabase
                            .from(tableName)
                            .select('*')
                            .limit(1);
                        
                        if (!error && data) {
                            console.log('Found table:', tableName, 'with data:', data);
                            foundTable = tableName;
                            foundData = data;
                            break;
                        }
                    } catch (e) {
                        console.log('Table', tableName, 'not found or error:', e.message);
                    }
                }
                
                if (!foundTable) {
                    console.error('No valid table found');
                    document.getElementById('groceriesTableBody').innerHTML = 
                        '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">No table found. Please check your Supabase database for table names.</td></tr>';
                    return;
                }
                
                console.log('Using table:', foundTable);
                
                // Load data from the found table
                const { data: groceries, error } = await supabase
                    .from(foundTable)
                    .select('*');
                
                console.log('Supabase connection successful');
                
                if (error) {
                    console.error('Error loading groceries:', error);
                    document.getElementById('groceriesTableBody').innerHTML = 
                        '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error: ' + error.message + '</td></tr>';
                    return;
                }
                
                console.log('Groceries loaded:', groceries);
                console.log('Number of groceries:', groceries ? groceries.length : 0);
                
                if (!groceries || groceries.length === 0) {
                    console.log('No groceries found in database');
                    document.getElementById('groceriesTableBody').innerHTML = 
                        '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No products found in database</td></tr>';
                    return;
                }
                
                // Update stats
                updateStats(groceries);
                
                // Update groceries table
                updateGroceriesTable(groceries);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                document.getElementById('groceriesTableBody').innerHTML = 
                    '<tr><td colspan="6" class="px-6 py-4 text-center text-red-500">Error: ' + error.message + '</td></tr>';
            }
        }

        // Update dashboard statistics
        function updateStats(groceries) {
            // Total products
            document.getElementById('totalProducts').textContent = groceries.length;
            
            // Total revenue (estimated)
            const totalRevenue = groceries.reduce((sum, item) => sum + (item.price * item.stock_quantity), 0);
            document.getElementById('totalRevenue').textContent = `â‚¹${totalRevenue.toLocaleString()}`;
            
            // Categories
            const categories = [...new Set(groceries.map(item => item.category))];
            document.getElementById('totalCategories').textContent = categories.length;
            
            // Low stock items (less than 50)
            const lowStockItems = groceries.filter(item => item.stock_quantity < 50).length;
            document.getElementById('lowStockItems').textContent = lowStockItems;
        }

        // Update groceries table
        function updateGroceriesTable(groceries) {
            const tbody = document.getElementById('groceriesTableBody');
            
            if (groceries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">No products found</td></tr>';
                return;
            }
            
            tbody.innerHTML = groceries.map(item => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${item.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚¹${item.price}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.stock_quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                </tr>
            `).join('');
        }

        // Show error message
        function showError(message) {
            loginError.textContent = message;
            loginError.classList.remove('hidden');
        }

        // Hide error message
        function hideError() {
            loginError.classList.add('hidden');
        }

        // Modal functions
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
        }

        function hideAddProductModal() {
            document.getElementById('addProductModal').classList.add('hidden');
            document.getElementById('addProductForm').reset();
        }

        // Add product form submission
        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock_quantity: parseInt(document.getElementById('productStock').value),
                unit: document.getElementById('productUnit').value
            };
            
            try {
                const tableName = document.getElementById('tableNameInput').value.trim() || 'groceries';
                const { data, error } = await supabase
                    .from(tableName)
                    .insert([formData]);
                
                if (error) {
                    console.error('Error adding product:', error);
                    alert('Error adding product: ' + error.message);
                    return;
                }
                
                hideAddProductModal();
                loadDashboardData();
                alert('Product added successfully!');
                
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Error adding product');
            }
        });

        // Initialize
        showLogin();
    </script>
</body>
</html>
